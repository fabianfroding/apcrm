# Class Role Identifier

Class Role Identifier (CRI) is a tool to automatically classify a Java class/object into one of the role stereotypes defined by Wirfs-Brock (Nurwidyantoro et al., 2019). These are the role-stereotypes (Wirfs-Brock, 2006):

- **(CT)** Controller: objects designed to make decisions and control complex tasks,
- **(CO)** Coordinator: objects that do not make many decisions, but in a rote or mechanical way, delegate work to other objects
- **(IH)** Information holder: object designed to know certain information and provide that information to others.
- **(IT)** Interfacer: objects that transform information and requests between distinct parts of a system. It can be a user interfacer object that interacts with users. An interfacer can communicate with external systems or between internal subsystems.
- **(SP)** Service provider: objects that perform work and offer services to others on demand.
- **(ST)** Structurer: objects that maintain relationships between objects and information about those relationships. Structurers might pool, collect, and maintain groups of objects.

These artefacts provide an extension to the previous work (Nurwidyantoro et al., 2019) by training the model with additional datasets, namely Bitcoin Wallet and Sweet Home 3D.

## Required Installation

To clone this repository, you need to install GitHub Large File Storage prior to the cloning. You can get it [here](https://git-lfs.github.com/)

## Files and Directory Structure

- `models/`: contains model files pre-trained with K-9 Mail, Bitcoin Wallet, and Sweet Home 3D datasets
    - `binary model/`: contains model files for binary classification (e.g. `rf-three-cases-SMOTE-CO-0202.sav`: a model to classify whether a class is an Information Holder or not)

File name | K-9 | Bitcoin | Sweet Home | SMOTE
----------|-----|---------|------------|-------
`rf-bitcoinwallet-sweethome3d-model-0202.sav`| |[x]|[x]|
`rf-k9-bitcoinwallet-model-0202.sav`|[x]|[x]||
`rf-k9-sweethome3d-model-0202.sav`|[x]| |[x]|
`rf-smote-bitcoinwallet-sweethome3d-model-`||[x]|[x]|[x]
`rf-smote-k9-bitcoinwallet-model-0202.sav`|[x]|[x]||[x]
`rf-smote-k9-model-0202.sav`|[x]|||[x]
`rf-smote-k9-sweethome3d-model-0202.sav`|[x]||[x]|[x]
`rf-smote-three-cases-model-0202.sav`|[x]|[x]|[x]|[x]

- `sample\`: contain sample files for running the classifier
- `README.md`: this README file (this file).
- `classifier.py`: code for classifying a feature file (see `sample\` folder).


## How to Run

### Classification

Python library requirements:

- `pickle`
- `scikit-learn (0.20.2)`


To run the classifier, using command prompt, go to the home directory (e.g. `cri\`)

```
cd cri\
```

Then, run the following command

```
python classifier.py <model_file> <feature_file.csv> <output_file.csv>
```

For example:

```
python classifier.py models\rf-smote-k9-model-0202.sav sample\sample.csv sample\sample-classified.csv
```

### Feature Extraction

System requirements:

- `srcML`, can be obtained in the [srcML website](https://www.srcml.org/#download). During development, we used version `0.9.5`.
- `Java Development Kit (JDK)`. During development, we used version `8 update 181`.

#### 1) Filter Java Files

This step copies Java files (`*.java`) from a project into a specified folder. To do so, run the following command:

`python filter_java.py <project folder> <output folder>`

For example, if the project files are in `sample\bitcoin-wallet-6.31`, then the command should be something like this:

`python filter_java.py sample\bitcoin-wallet-6.31 sample\bitcoin-wallet-src`

where `sample\bitcoin-wallet-src` is the destination directory for the Java files.

#### 2) Create srcML Representation of the Java Files

This step creates srcML representation (`*.xml`) of the Java project files.

First, go to the directory of the project. For example, using our previous `sample\bitcoin-wallet-src`, then the command should be:

`cd sample\bitcoin-wallet-src`

Then, run the following srcML command:

`srcml . -o ..\bitcoin-wallet.xml`

Where `..\bitcoin-wallet.xml` is the name of the XML file. You can specify any name you want. You then can find the XML file outside the project folder. Go there using the following command:

`cd ..`

#### 3) Extract Inner Classes

This step extracts inner classes of the project using the XML file generated by srcML as the input.

To extract the inner class, use the following command:

`java -jar lib\Parser.jar inner <srcml file> <output directory>`

First, make sure you are on the top level directory of this project.

Then, use the following command:

`java -jar lib\Parser.jar inner sample\bitcoin-wallet.xml sample\bitcoin-wallet-inner`

#### 4) Optimize Import

Because we extracted the inner classes, there might be some unused import. This step optimizes the import statements by removing all unused imports.

To do so, use the following command:
`java -jar lib\Parser.jar optimize <source directory> <output directory> <log file name> lib\sun_checks.xml`

For example, again, make sure you are on the top level directory of this project.

Then, run the following command:

`java -jar lib\Parser.jar optimize sample\bitcoin-wallet-inner sample\bitcoin-wallet-optimized sample\bitcoin.log lib\sun_checks.xml`

You can change the name of the output directory and the log file.

#### 5) Create srcML Representation of the Optimized Java Files

This step creates the srcML representation (`*.xml`) of the optimized Java files.

First, go to the directory of the project. For example, using our previous `sample\bitcoin-wallet-src`, then the command should be:

`cd sample\bitcoin-wallet-optimized`

Then, run the following srcML command:

`srcml . -o ..\bitcoin-wallet-opt.xml`

Where `..\bitcoin-wallet-opt.xml` is the name of the XML file. You can specify any name you want. You then can find the XML file outside the project folder. Go there using the following command:

`cd ..`

#### 6) Extract Features

This step extracts features as a csv file.

First, go to the top level directory of the project. Then, run the following command:

`java -jar lib\Parser.jar feature <optimized srcML file> <output file>`

For example, using the generated XML, run the following command:

`java -jar lib\Parser.jar feature sample\bitcoin-wallet-opt.xml sample\bitcoin_features.csv`

#### 7) DONE

Do not forget to remove the first line: `sep=;` before running the classifier. 


## References

- Nurwidyantoro, A., Ho-Quang, T., Chaudron, M. (2019). Automated Classification of Class Role-Stereotypes via Machine Learning. In the Proceedings of the Evaluation and Assessment on Software Engineering, 79-88.
- Wirfs-Brock, R. J. (2006). Characterizing classes. IEEE Software, 23(2), 9â€“11. https://doi.org/10.1109/MS.2006.43
